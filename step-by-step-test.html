<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é€æ­¥è¼‰å…¥æ¸¬è©¦ - Vibe Coding Academy</title>
    <link rel="stylesheet" href="src/styles/global.css">
    <style>
        .debug-panel {
            position: fixed;
            top: 10px;
            right: 10px;
            width: 300px;
            max-height: 80vh;
            background: rgba(0,0,0,0.9);
            color: #0f0;
            padding: 15px;
            border-radius: 8px;
            font-family: monospace;
            font-size: 11px;
            z-index: 9999;
            overflow-y: auto;
        }
        .step {
            margin: 8px 0;
            padding: 5px;
            background: rgba(255,255,255,0.1);
            border-radius: 3px;
            border-left: 3px solid #555;
        }
        .step.success { border-left-color: #0f0; color: #0f0; }
        .step.error { border-left-color: #f00; color: #f00; }
        .step.warning { border-left-color: #ff0; color: #ff0; }
        .step.info { border-left-color: #0af; color: #0af; }
        .load-button {
            background: #007bff;
            color: white;
            border: none;
            padding: 5px 10px;
            margin: 2px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 10px;
        }
        .load-button:hover { background: #0056b3; }
        .load-button:disabled { background: #666; cursor: not-allowed; }
    </style>
</head>
<body>
    <!-- é™¤éŒ¯é¢æ¿ -->
    <div class="debug-panel">
        <h4>ğŸ”§ é€æ­¥è¼‰å…¥æ¸¬è©¦</h4>
        <div>
            <button class="load-button" onclick="loadComponents()" id="load-components">è¼‰å…¥åŸºç¤çµ„ä»¶</button>
            <button class="load-button" onclick="loadUtils()" id="load-utils" disabled>è¼‰å…¥å·¥å…·é¡åˆ¥</button>
            <button class="load-button" onclick="loadCollectors()" id="load-collectors" disabled>è¼‰å…¥æ”¶é›†å™¨</button>
            <button class="load-button" onclick="initializeApp()" id="init-app" disabled>åˆå§‹åŒ–æ‡‰ç”¨</button>
            <button class="load-button" onclick="clearLog()">æ¸…é™¤æ—¥èªŒ</button>
        </div>
        <div id="log-output">æº–å‚™é–‹å§‹æ¸¬è©¦...</div>
    </div>

    <!-- ç°¡åŒ–çš„HTMLçµæ§‹ -->
    <div id="app" class="app-container">
        <header class="app-header">
            <h1 class="app-title">ğŸ® Vibe Coding Academy</h1>
            <p class="app-subtitle">é€æ­¥è¼‰å…¥æ¸¬è©¦</p>
        </header>

        <main class="main-content">
            <div id="loading-screen" class="loading-screen" style="display: flex;">
                <div class="loading-spinner"></div>
                <p id="loading-text">ç­‰å¾…é–‹å§‹æ¸¬è©¦...</p>
            </div>

            <div id="test-result" class="hidden">
                <h3>ğŸ‰ æ¸¬è©¦å®Œæˆï¼</h3>
                <p>æ‰€æœ‰çµ„ä»¶å·²æˆåŠŸè¼‰å…¥ä¸¦åˆå§‹åŒ–ã€‚</p>
            </div>
        </main>
    </div>

    <script>
        let loadedScripts = [];
        let testStep = 0;

        // æ—¥èªŒå‡½æ•¸
        function log(message, type = 'info') {
            const output = document.getElementById('log-output');
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.className = `step ${type}`;
            logEntry.innerHTML = `[${timestamp}] ${message}`;
            output.appendChild(logEntry);
            
            // è‡ªå‹•æ»¾å‹•åˆ°åº•éƒ¨
            output.scrollTop = output.scrollHeight;
            
            console.log(`[STEP TEST] ${message}`);
        }

        function clearLog() {
            document.getElementById('log-output').innerHTML = 'æ—¥èªŒå·²æ¸…é™¤...';
        }

        // å‹•æ…‹è¼‰å…¥è…³æœ¬å‡½æ•¸
        function loadScript(src, callback) {
            return new Promise((resolve, reject) => {
                if (loadedScripts.includes(src)) {
                    log(`âš ï¸ è…³æœ¬å·²è¼‰å…¥: ${src}`, 'warning');
                    resolve();
                    return;
                }

                const script = document.createElement('script');
                script.src = src;
                
                script.onload = () => {
                    loadedScripts.push(src);
                    log(`âœ… è¼‰å…¥æˆåŠŸ: ${src}`, 'success');
                    resolve();
                };
                
                script.onerror = (error) => {
                    log(`âŒ è¼‰å…¥å¤±æ•—: ${src}`, 'error');
                    reject(new Error(`Failed to load ${src}`));
                };
                
                document.head.appendChild(script);
            });
        }

        // æª¢æŸ¥é¡åˆ¥æ˜¯å¦å­˜åœ¨
        function checkClass(className) {
            const exists = typeof window[className] === 'function';
            log(`æª¢æŸ¥é¡åˆ¥ ${className}: ${exists ? 'âœ… å­˜åœ¨' : 'âŒ ä¸å­˜åœ¨'}`, 
                exists ? 'success' : 'error');
            return exists;
        }

        // ç¬¬ä¸€æ­¥ï¼šè¼‰å…¥åŸºç¤çµ„ä»¶
        async function loadComponents() {
            log('ğŸš€ é–‹å§‹è¼‰å…¥åŸºç¤çµ„ä»¶...', 'info');
            
            const components = [
                'src/components/Card.js',
                'src/components/DialogueBox.js', 
                'src/components/ProgressBar.js'
            ];

            try {
                for (const component of components) {
                    await loadScript(component);
                    // ç¨å¾®å»¶é²ä»¥ä¾¿è§€å¯Ÿ
                    await new Promise(resolve => setTimeout(resolve, 100));
                }

                // æª¢æŸ¥çµ„ä»¶é¡åˆ¥
                const componentClasses = ['Card', 'CardManager', 'DialogueBox', 'DialogueManager', 'ProgressBar', 'ProgressManager'];
                let loadedCount = 0;
                
                componentClasses.forEach(className => {
                    if (checkClass(className)) {
                        loadedCount++;
                    }
                });

                log(`åŸºç¤çµ„ä»¶è¼‰å…¥å®Œæˆ: ${loadedCount}/${componentClasses.length}`, 
                    loadedCount === componentClasses.length ? 'success' : 'warning');

                // å•Ÿç”¨ä¸‹ä¸€å€‹æŒ‰éˆ•
                document.getElementById('load-components').disabled = true;
                document.getElementById('load-utils').disabled = false;
                
            } catch (error) {
                log(`âŒ åŸºç¤çµ„ä»¶è¼‰å…¥å¤±æ•—: ${error.message}`, 'error');
            }
        }

        // ç¬¬äºŒæ­¥ï¼šè¼‰å…¥å·¥å…·é¡åˆ¥
        async function loadUtils() {
            log('ğŸ”§ é–‹å§‹è¼‰å…¥å·¥å…·é¡åˆ¥...', 'info');
            
            const utils = [
                'src/utils/requirementParser.js',
                'src/utils/outputGenerator.js',
                'src/utils/validationHelper.js'
            ];

            try {
                for (const util of utils) {
                    await loadScript(util);
                    await new Promise(resolve => setTimeout(resolve, 100));
                }

                // æª¢æŸ¥å·¥å…·é¡åˆ¥
                const utilClasses = ['RequirementParser', 'OutputGenerator', 'ValidationHelper'];
                let loadedCount = 0;
                
                utilClasses.forEach(className => {
                    if (checkClass(className)) {
                        loadedCount++;
                    }
                });

                log(`å·¥å…·é¡åˆ¥è¼‰å…¥å®Œæˆ: ${loadedCount}/${utilClasses.length}`, 
                    loadedCount === utilClasses.length ? 'success' : 'warning');

                // å•Ÿç”¨ä¸‹ä¸€å€‹æŒ‰éˆ•
                document.getElementById('load-utils').disabled = true;
                document.getElementById('load-collectors').disabled = false;
                
            } catch (error) {
                log(`âŒ å·¥å…·é¡åˆ¥è¼‰å…¥å¤±æ•—: ${error.message}`, 'error');
            }
        }

        // ç¬¬ä¸‰æ­¥ï¼šè¼‰å…¥æ”¶é›†å™¨
        async function loadCollectors() {
            log('ğŸ“Š é–‹å§‹è¼‰å…¥æ”¶é›†å™¨...', 'info');
            
            const collectors = [
                'src/collectors/ProjectTypeCollector.js',
                'src/collectors/DesignStyleCollector.js',
                'src/collectors/FeatureCollector.js',
                'src/collectors/TechStackCollector.js',
                'src/collectors/DeploymentCollector.js'
            ];

            try {
                for (const collector of collectors) {
                    await loadScript(collector);
                    await new Promise(resolve => setTimeout(resolve, 100));
                }

                // æª¢æŸ¥æ”¶é›†å™¨é¡åˆ¥
                const collectorClasses = [
                    'ProjectTypeCollector', 'DesignStyleCollector', 'FeatureCollector',
                    'TechStackCollector', 'DeploymentCollector'
                ];
                let loadedCount = 0;
                
                collectorClasses.forEach(className => {
                    if (checkClass(className)) {
                        loadedCount++;
                    }
                });

                log(`æ”¶é›†å™¨è¼‰å…¥å®Œæˆ: ${loadedCount}/${collectorClasses.length}`, 
                    loadedCount === collectorClasses.length ? 'success' : 'warning');

                // å•Ÿç”¨ä¸‹ä¸€å€‹æŒ‰éˆ•
                document.getElementById('load-collectors').disabled = true;
                document.getElementById('init-app').disabled = false;
                
            } catch (error) {
                log(`âŒ æ”¶é›†å™¨è¼‰å…¥å¤±æ•—: ${error.message}`, 'error');
            }
        }

        // ç¬¬å››æ­¥ï¼šåˆå§‹åŒ–æ‡‰ç”¨
        async function initializeApp() {
            log('ğŸ® é–‹å§‹åˆå§‹åŒ–æ‡‰ç”¨...', 'info');
            
            try {
                // è¼‰å…¥ä¸»æ‡‰ç”¨
                await loadScript('src/app.js');
                
                // æª¢æŸ¥VibeCodingAcademyé¡åˆ¥
                if (checkClass('VibeCodingAcademy')) {
                    
                    // å˜—è©¦å‰µå»ºå¯¦ä¾‹
                    log('ğŸ—ï¸ å˜—è©¦å‰µå»ºæ‡‰ç”¨å¯¦ä¾‹...', 'info');
                    
                    try {
                        window.testApp = new window.VibeCodingAcademy();
                        log('âœ… æ‡‰ç”¨å¯¦ä¾‹å‰µå»ºæˆåŠŸï¼', 'success');
                        
                        // æª¢æŸ¥å¯¦ä¾‹ç‹€æ…‹
                        if (window.testApp.isInitialized) {
                            log('âœ… æ‡‰ç”¨å·²æˆåŠŸåˆå§‹åŒ–', 'success');
                        } else {
                            log('âš ï¸ æ‡‰ç”¨å¯¦ä¾‹å·²å‰µå»ºä½†æœªå®Œæˆåˆå§‹åŒ–', 'warning');
                        }
                        
                        // é¡¯ç¤ºæˆåŠŸçµæœ
                        setTimeout(() => {
                            const loadingScreen = document.getElementById('loading-screen');
                            const testResult = document.getElementById('test-result');
                            
                            if (loadingScreen) loadingScreen.style.display = 'none';
                            if (testResult) testResult.classList.remove('hidden');
                            
                            log('ğŸ‰ æ¸¬è©¦å®Œæˆï¼æ‡‰ç”¨ç¨‹å¼å¯ä»¥æ­£å¸¸é‹è¡Œ', 'success');
                        }, 1000);
                        
                    } catch (initError) {
                        log(`âŒ æ‡‰ç”¨å¯¦ä¾‹å‰µå»ºå¤±æ•—: ${initError.message}`, 'error');
                        log(`éŒ¯èª¤è©³æƒ…: ${initError.stack}`, 'error');
                    }
                    
                } else {
                    log('âŒ VibeCodingAcademy é¡åˆ¥æœªæ‰¾åˆ°', 'error');
                }
                
                document.getElementById('init-app').disabled = true;
                
            } catch (error) {
                log(`âŒ æ‡‰ç”¨åˆå§‹åŒ–å¤±æ•—: ${error.message}`, 'error');
            }
        }

        // å…¨åŸŸéŒ¯èª¤è™•ç†
        window.addEventListener('error', (e) => {
            log(`âŒ å…¨åŸŸéŒ¯èª¤: ${e.message} (${e.filename}:${e.lineno})`, 'error');
        });

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            log('ğŸ“„ é é¢è¼‰å…¥å®Œæˆï¼Œæº–å‚™é–‹å§‹æ¸¬è©¦', 'success');
        });

        log('ğŸ“œ é€æ­¥æ¸¬è©¦è…³æœ¬å·²è¼‰å…¥', 'info');
    </script>
</body>
</html>