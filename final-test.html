<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æœ€çµ‚åŠŸèƒ½æ¸¬è©¦</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #1a1a2e;
            color: #eee;
        }
        .test-panel {
            background: #16213e;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            border: 1px solid #0f3460;
        }
        .status {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
        }
        .status.success { background: #28a745; color: white; }
        .status.error { background: #dc3545; color: white; }
        .status.warning { background: #ffc107; color: black; }
        .status.info { background: #17a2b8; color: white; }
        .test-item {
            margin: 10px 0;
            padding: 8px;
            background: rgba(255,255,255,0.1);
            border-radius: 4px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #0056b3;
        }
        .summary {
            background: rgba(40, 167, 69, 0.1);
            border: 1px solid #28a745;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
        }
        .summary.error {
            background: rgba(220, 53, 69, 0.1);
            border-color: #dc3545;
        }
    </style>
</head>
<body>
    <h1>ğŸ¯ Vibe Coding Academy æœ€çµ‚åŠŸèƒ½æ¸¬è©¦</h1>
    
    <div class="test-panel">
        <h2>ğŸ“Š ç³»çµ±æ•´é«”æª¢æŸ¥</h2>
        <div id="system-check">æª¢æŸ¥ä¸­...</div>
        <button onclick="runSystemCheck()">é‡æ–°æª¢æŸ¥ç³»çµ±</button>
    </div>

    <div class="test-panel">
        <h2>ğŸ”§ æ ¸å¿ƒåŠŸèƒ½æ¸¬è©¦</h2>
        <div id="core-tests">
            <div class="test-item">
                <span>JavaScripté¡åˆ¥è¼‰å…¥</span>
                <span id="js-classes-status" class="status info">ç­‰å¾…æ¸¬è©¦</span>
            </div>
            <div class="test-item">
                <span>DOMå…ƒç´ å®Œæ•´æ€§</span>
                <span id="dom-elements-status" class="status info">ç­‰å¾…æ¸¬è©¦</span>
            </div>
            <div class="test-item">
                <span>Appå¯¦ä¾‹å‰µå»º</span>
                <span id="app-instance-status" class="status info">ç­‰å¾…æ¸¬è©¦</span>
            </div>
            <div class="test-item">
                <span>Loading Screené¡¯ç¤º</span>
                <span id="loading-screen-status" class="status info">ç­‰å¾…æ¸¬è©¦</span>
            </div>
            <div class="test-item">
                <span>éŠæˆ²å®¹å™¨æº–å‚™</span>
                <span id="game-container-status" class="status info">ç­‰å¾…æ¸¬è©¦</span>
            </div>
        </div>
        <button onclick="runCoreTests()">åŸ·è¡Œæ ¸å¿ƒæ¸¬è©¦</button>
    </div>

    <div class="test-panel">
        <h2>ğŸ® äº’å‹•åŠŸèƒ½æ¨¡æ“¬</h2>
        <div id="interaction-tests">
            <div class="test-item">
                <span>é–‹å§‹æŒ‰éˆ•é»æ“Š</span>
                <span id="start-button-status" class="status info">ç­‰å¾…æ¸¬è©¦</span>
            </div>
            <div class="test-item">
                <span>éšæ®µåˆ‡æ›</span>
                <span id="stage-switch-status" class="status info">ç­‰å¾…æ¸¬è©¦</span>
            </div>
            <div class="test-item">
                <span>å°è©±æ¡†äº’å‹•</span>
                <span id="dialogue-status" class="status info">ç­‰å¾…æ¸¬è©¦</span>
            </div>
        </div>
        <button onclick="runInteractionTests()">åŸ·è¡Œäº’å‹•æ¸¬è©¦</button>
        <button onclick="openMainApp()">é–‹å•Ÿä¸»æ‡‰ç”¨ç¨‹å¼</button>
    </div>

    <div class="test-panel">
        <h2>ğŸ“ˆ æ€§èƒ½èˆ‡ç©©å®šæ€§</h2>
        <div id="performance-tests">
            <div class="test-item">
                <span>è¼‰å…¥æ™‚é–“</span>
                <span id="load-time-status" class="status info">ç­‰å¾…æ¸¬è©¦</span>
            </div>
            <div class="test-item">
                <span>è¨˜æ†¶é«”ä½¿ç”¨</span>
                <span id="memory-status" class="status info">ç­‰å¾…æ¸¬è©¦</span>
            </div>
            <div class="test-item">
                <span>ç©©å®šæ€§æ¸¬è©¦</span>
                <span id="stability-status" class="status info">ç­‰å¾…æ¸¬è©¦</span>
            </div>
        </div>
        <button onclick="runPerformanceTests()">åŸ·è¡Œæ€§èƒ½æ¸¬è©¦</button>
    </div>

    <div id="test-summary" class="summary" style="display: none;">
        <h3>ğŸ“‹ æ¸¬è©¦ç¸½çµ</h3>
        <div id="summary-content"></div>
    </div>

    <script>
        let testResults = {
            systemCheck: {},
            coreTests: {},
            interactionTests: {},
            performanceTests: {}
        };

        function updateStatus(elementId, status, text) {
            const element = document.getElementById(elementId);
            if (element) {
                element.className = `status ${status}`;
                element.textContent = text;
            }
        }

        function log(message) {
            console.log(`[æœ€çµ‚æ¸¬è©¦] ${message}`);
        }

        function runSystemCheck() {
            log('é–‹å§‹ç³»çµ±æ•´é«”æª¢æŸ¥...');
            
            const checks = [
                {
                    name: 'ä¼ºæœå™¨é€£æ¥',
                    test: () => fetch('http://localhost:8000').then(r => r.ok),
                    async: true
                },
                {
                    name: 'ç€è¦½å™¨å…¼å®¹æ€§',
                    test: () => {
                        return !!(window.fetch && window.Promise && window.addEventListener);
                    }
                },
                {
                    name: 'CSSè¼‰å…¥',
                    test: () => {
                        const computed = getComputedStyle(document.body);
                        return computed.fontFamily && computed.backgroundColor;
                    }
                }
            ];

            let results = [];
            let completed = 0;

            checks.forEach(async (check, index) => {
                try {
                    let result;
                    if (check.async) {
                        result = await check.test();
                    } else {
                        result = check.test();
                    }
                    results[index] = { name: check.name, status: result ? 'success' : 'error' };
                } catch (error) {
                    results[index] = { name: check.name, status: 'error', error: error.message };
                }
                
                completed++;
                if (completed === checks.length) {
                    displaySystemCheck(results);
                }
            });

            testResults.systemCheck = results;
        }

        function displaySystemCheck(results) {
            let html = '';
            results.forEach(result => {
                const statusText = result.status === 'success' ? 'PASS' : 'FAIL';
                html += `<div class="test-item">
                    <span>${result.name}</span>
                    <span class="status ${result.status}">${statusText}</span>
                </div>`;
            });
            document.getElementById('system-check').innerHTML = html;
        }

        function runCoreTests() {
            log('é–‹å§‹æ ¸å¿ƒåŠŸèƒ½æ¸¬è©¦...');

            // JavaScripté¡åˆ¥è¼‰å…¥æ¸¬è©¦
            const requiredClasses = [
                'VibeCodingAcademy', 'DialogueBox', 'ProgressBar', 'CardManager',
                'ProjectTypeCollector', 'DesignStyleCollector', 'FeatureCollector',
                'TechStackCollector', 'DeploymentCollector',
                'RequirementParser', 'OutputGenerator', 'ValidationHelper'
            ];

            let classesLoaded = 0;
            requiredClasses.forEach(className => {
                if (typeof window[className] === 'function') {
                    classesLoaded++;
                }
            });

            const classLoadPercentage = Math.round((classesLoaded / requiredClasses.length) * 100);
            updateStatus('js-classes-status', 
                classLoadPercentage === 100 ? 'success' : (classLoadPercentage > 50 ? 'warning' : 'error'),
                `${classLoadPercentage}% (${classesLoaded}/${requiredClasses.length})`
            );

            // DOMå…ƒç´ å®Œæ•´æ€§æ¸¬è©¦
            const requiredElements = [
                'loading-screen', 'game-container', 'dialogue-box', 
                'card-container', 'start-btn'
            ];

            let elementsFound = 0;
            requiredElements.forEach(elementId => {
                const element = document.querySelector(`#${elementId}`) || document.querySelector(`.${elementId}`);
                if (element) elementsFound++;
            });

            const elementPercentage = Math.round((elementsFound / requiredElements.length) * 100);
            updateStatus('dom-elements-status',
                elementPercentage === 100 ? 'success' : (elementPercentage > 50 ? 'warning' : 'error'),
                `${elementPercentage}% (${elementsFound}/${requiredElements.length})`
            );

            // Appå¯¦ä¾‹å‰µå»ºæ¸¬è©¦
            if (window.app) {
                updateStatus('app-instance-status', 'success', 
                    `å·²å‰µå»º (${window.app.isInitialized ? 'å·²åˆå§‹åŒ–' : 'æœªåˆå§‹åŒ–'})`);
            } else {
                // å˜—è©¦å‰µå»ºAppå¯¦ä¾‹
                try {
                    if (typeof window.VibeCodingAcademy === 'function') {
                        window.testApp = new window.VibeCodingAcademy();
                        updateStatus('app-instance-status', 'warning', 'æ¸¬è©¦å¯¦ä¾‹å·²å‰µå»º');
                    } else {
                        updateStatus('app-instance-status', 'error', 'VibeCodingAcademyé¡åˆ¥ä¸å­˜åœ¨');
                    }
                } catch (error) {
                    updateStatus('app-instance-status', 'error', `å‰µå»ºå¤±æ•—: ${error.message}`);
                }
            }

            // Loading Screené¡¯ç¤ºæ¸¬è©¦
            const loadingScreen = document.getElementById('loading-screen');
            if (loadingScreen) {
                const isVisible = getComputedStyle(loadingScreen).display !== 'none';
                updateStatus('loading-screen-status', 
                    isVisible ? 'success' : 'warning',
                    isVisible ? 'å¯è¦‹' : 'éš±è—'
                );
            } else {
                updateStatus('loading-screen-status', 'error', 'å…ƒç´ ä¸å­˜åœ¨');
            }

            // éŠæˆ²å®¹å™¨æº–å‚™æ¸¬è©¦
            const gameContainer = document.getElementById('game-container');
            if (gameContainer) {
                const isHidden = gameContainer.classList.contains('hidden');
                updateStatus('game-container-status',
                    isHidden ? 'success' : 'warning',
                    isHidden ? 'æ­£ç¢ºéš±è—' : 'æ„å¤–å¯è¦‹'
                );
            } else {
                updateStatus('game-container-status', 'error', 'å…ƒç´ ä¸å­˜åœ¨');
            }

            testResults.coreTests = {
                classesLoaded: classLoadPercentage,
                elementsFound: elementPercentage,
                appInstance: !!window.app,
                loadingScreen: !!loadingScreen,
                gameContainer: !!gameContainer
            };
        }

        function runInteractionTests() {
            log('é–‹å§‹äº’å‹•åŠŸèƒ½æ¸¬è©¦...');

            // é–‹å§‹æŒ‰éˆ•é»æ“Šæ¸¬è©¦
            const startButton = document.getElementById('start-btn');
            if (startButton) {
                try {
                    // æ¨¡æ“¬é»æ“Šäº‹ä»¶
                    const clickEvent = new MouseEvent('click', {
                        bubbles: true,
                        cancelable: true,
                        view: window
                    });
                    startButton.dispatchEvent(clickEvent);
                    updateStatus('start-button-status', 'success', 'é»æ“Šäº‹ä»¶å·²è§¸ç™¼');
                } catch (error) {
                    updateStatus('start-button-status', 'error', `é»æ“Šå¤±æ•—: ${error.message}`);
                }
            } else {
                updateStatus('start-button-status', 'warning', 'æŒ‰éˆ•ä¸å­˜åœ¨');
            }

            // éšæ®µåˆ‡æ›æ¸¬è©¦
            if (window.app && typeof window.app.goToStage === 'function') {
                try {
                    window.app.goToStage(0);
                    updateStatus('stage-switch-status', 'success', 'éšæ®µåˆ‡æ›åŠŸèƒ½æ­£å¸¸');
                } catch (error) {
                    updateStatus('stage-switch-status', 'error', `åˆ‡æ›å¤±æ•—: ${error.message}`);
                }
            } else {
                updateStatus('stage-switch-status', 'warning', 'éšæ®µåˆ‡æ›åŠŸèƒ½ä¸å¯ç”¨');
            }

            // å°è©±æ¡†äº’å‹•æ¸¬è©¦
            if (window.app && window.app.dialogueBox) {
                try {
                    const testDialogue = {
                        title: 'æ¸¬è©¦å°è©±',
                        text: 'é€™æ˜¯åŠŸèƒ½æ¸¬è©¦',
                        mood: 'default'
                    };
                    window.app.dialogueBox.showDialogue(testDialogue);
                    updateStatus('dialogue-status', 'success', 'å°è©±æ¡†äº’å‹•æ­£å¸¸');
                } catch (error) {
                    updateStatus('dialogue-status', 'error', `å°è©±æ¡†å¤±æ•—: ${error.message}`);
                }
            } else {
                updateStatus('dialogue-status', 'warning', 'å°è©±æ¡†çµ„ä»¶ä¸å¯ç”¨');
            }

            testResults.interactionTests = {
                startButton: !!startButton,
                stageSwitch: !!(window.app && window.app.goToStage),
                dialogue: !!(window.app && window.app.dialogueBox)
            };
        }

        function runPerformanceTests() {
            log('é–‹å§‹æ€§èƒ½æ¸¬è©¦...');

            // è¼‰å…¥æ™‚é–“æ¸¬è©¦
            const startTime = performance.now();
            
            setTimeout(() => {
                const loadTime = performance.now() - startTime;
                updateStatus('load-time-status',
                    loadTime < 100 ? 'success' : (loadTime < 500 ? 'warning' : 'error'),
                    `${Math.round(loadTime)}ms`
                );
            }, 10);

            // è¨˜æ†¶é«”ä½¿ç”¨æ¸¬è©¦
            if (performance.memory) {
                const memoryUsage = Math.round(performance.memory.usedJSHeapSize / 1024 / 1024);
                updateStatus('memory-status',
                    memoryUsage < 50 ? 'success' : (memoryUsage < 100 ? 'warning' : 'error'),
                    `${memoryUsage}MB`
                );
            } else {
                updateStatus('memory-status', 'info', 'è¨˜æ†¶é«”APIä¸å¯ç”¨');
            }

            // ç©©å®šæ€§æ¸¬è©¦ (å¤šæ¬¡å‰µå»ºå¯¦ä¾‹)
            let stabilityScore = 0;
            try {
                for (let i = 0; i < 5; i++) {
                    if (typeof window.VibeCodingAcademy === 'function') {
                        const testInstance = new window.VibeCodingAcademy();
                        if (testInstance) {
                            stabilityScore++;
                        }
                    }
                }
                updateStatus('stability-status',
                    stabilityScore === 5 ? 'success' : (stabilityScore > 2 ? 'warning' : 'error'),
                    `${stabilityScore}/5 æ¬¡æˆåŠŸ`
                );
            } catch (error) {
                updateStatus('stability-status', 'error', `ç©©å®šæ€§æ¸¬è©¦å¤±æ•—: ${error.message}`);
            }

            testResults.performanceTests = {
                loadTime: performance.now() - startTime,
                memoryUsage: performance.memory ? performance.memory.usedJSHeapSize : null,
                stability: stabilityScore
            };
        }

        function openMainApp() {
            log('é–‹å•Ÿä¸»æ‡‰ç”¨ç¨‹å¼...');
            window.open('http://localhost:8000', '_blank');
        }

        function showTestSummary() {
            const summary = document.getElementById('test-summary');
            const content = document.getElementById('summary-content');
            
            let html = '';
            let totalTests = 0;
            let passedTests = 0;

            // çµ±è¨ˆæ¸¬è©¦çµæœ
            Object.values(testResults).forEach(category => {
                Object.values(category).forEach(result => {
                    totalTests++;
                    if (result === true || (typeof result === 'number' && result > 80)) {
                        passedTests++;
                    }
                });
            });

            const successRate = Math.round((passedTests / totalTests) * 100);
            
            html += `<div class="test-item">
                <span>æ•´é«”æˆåŠŸç‡</span>
                <span class="status ${successRate > 80 ? 'success' : (successRate > 50 ? 'warning' : 'error')}">
                    ${successRate}% (${passedTests}/${totalTests})
                </span>
            </div>`;

            html += `<p><strong>å»ºè­°ï¼š</strong></p>`;
            if (successRate > 80) {
                html += `<p>âœ… ç³»çµ±é‹è¡Œè‰¯å¥½ï¼Œæ‰€æœ‰æ ¸å¿ƒåŠŸèƒ½æ­£å¸¸é‹ä½œã€‚</p>`;
                summary.className = 'summary';
            } else if (successRate > 50) {
                html += `<p>âš ï¸ ç³»çµ±åŸºæœ¬å¯ç”¨ï¼Œä½†å»ºè­°æª¢æŸ¥å¤±æ•—çš„æ¸¬è©¦é …ç›®ã€‚</p>`;
                summary.className = 'summary';
            } else {
                html += `<p>âŒ ç³»çµ±å­˜åœ¨é‡å¤§å•é¡Œï¼Œéœ€è¦é€²ä¸€æ­¥ä¿®å¾©ã€‚</p>`;
                summary.className = 'summary error';
            }

            content.innerHTML = html;
            summary.style.display = 'block';
        }

        // è‡ªå‹•åŸ·è¡Œæ‰€æœ‰æ¸¬è©¦
        document.addEventListener('DOMContentLoaded', () => {
            log('æœ€çµ‚æ¸¬è©¦å·¥å…·å·²è¼‰å…¥');
            
            setTimeout(() => {
                runSystemCheck();
                setTimeout(() => {
                    runCoreTests();
                    setTimeout(() => {
                        runInteractionTests();
                        setTimeout(() => {
                            runPerformanceTests();
                            setTimeout(showTestSummary, 1000);
                        }, 1000);
                    }, 1000);
                }, 1000);
            }, 500);
        });
    </script>
</body>
</html>